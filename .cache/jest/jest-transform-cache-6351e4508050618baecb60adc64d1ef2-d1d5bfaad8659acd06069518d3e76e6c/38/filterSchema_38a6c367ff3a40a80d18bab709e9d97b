036ac0dd91ab3c05e4ce118d9faac60b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.filterSchema = void 0;
const graphql_1 = require("graphql");
const Interfaces_1 = require("./Interfaces");
const mapSchema_1 = require("./mapSchema");
function filterSchema({ schema, typeFilter = () => true, fieldFilter = undefined, rootFieldFilter = undefined, objectFieldFilter = undefined, interfaceFieldFilter = undefined, inputObjectFieldFilter = undefined, argumentFilter = undefined, }) {
    const filteredSchema = mapSchema_1.mapSchema(schema, {
        [Interfaces_1.MapperKind.QUERY]: (type) => filterRootFields(type, 'Query', rootFieldFilter, argumentFilter),
        [Interfaces_1.MapperKind.MUTATION]: (type) => filterRootFields(type, 'Mutation', rootFieldFilter, argumentFilter),
        [Interfaces_1.MapperKind.SUBSCRIPTION]: (type) => filterRootFields(type, 'Subscription', rootFieldFilter, argumentFilter),
        [Interfaces_1.MapperKind.OBJECT_TYPE]: (type) => typeFilter(type.name, type)
            ? filterElementFields(graphql_1.GraphQLObjectType, type, objectFieldFilter || fieldFilter, argumentFilter)
            : null,
        [Interfaces_1.MapperKind.INTERFACE_TYPE]: (type) => typeFilter(type.name, type)
            ? filterElementFields(graphql_1.GraphQLInterfaceType, type, interfaceFieldFilter || fieldFilter, argumentFilter)
            : null,
        [Interfaces_1.MapperKind.INPUT_OBJECT_TYPE]: (type) => typeFilter(type.name, type)
            ? filterElementFields(graphql_1.GraphQLInputObjectType, type, inputObjectFieldFilter || fieldFilter)
            : null,
        [Interfaces_1.MapperKind.UNION_TYPE]: (type) => (typeFilter(type.name, type) ? undefined : null),
        [Interfaces_1.MapperKind.ENUM_TYPE]: (type) => (typeFilter(type.name, type) ? undefined : null),
        [Interfaces_1.MapperKind.SCALAR_TYPE]: (type) => (typeFilter(type.name, type) ? undefined : null),
    });
    return filteredSchema;
}
exports.filterSchema = filterSchema;
function filterRootFields(type, operation, rootFieldFilter, argumentFilter) {
    if (rootFieldFilter || argumentFilter) {
        const config = type.toConfig();
        Object.entries(config.fields).forEach(([fieldName, field]) => {
            if (rootFieldFilter && !rootFieldFilter(operation, fieldName, config.fields[fieldName])) {
                delete config.fields[fieldName];
            }
            else if (argumentFilter) {
                for (const argName of Object.keys(field.args)) {
                    if (!argumentFilter(operation, fieldName, argName, field.args[argName])) {
                        delete field.args[argName];
                    }
                }
            }
        });
        return new graphql_1.GraphQLObjectType(config);
    }
    return type;
}
function filterElementFields(ElementConstructor, type, fieldFilter, argumentFilter) {
    if (fieldFilter || argumentFilter) {
        const config = type.toConfig();
        Object.entries(config.fields).forEach(([fieldName, field]) => {
            if (fieldFilter && !fieldFilter(type.name, fieldName, config.fields[fieldName])) {
                delete config.fields[fieldName];
            }
            else if (argumentFilter && 'args' in field) {
                for (const argName of Object.keys(field.args)) {
                    if (!argumentFilter(type.name, fieldName, argName, field.args[argName])) {
                        delete field.args[argName];
                    }
                }
            }
        });
        return new ElementConstructor(config);
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvYXJkYXRfMDAwL0d1aWxkL2dyYXBocWwtdG9vbHMvcGFja2FnZXMvdXRpbHMvc3JjL2ZpbHRlclNjaGVtYS50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxxQ0FRaUI7QUFFakIsNkNBQW9HO0FBRXBHLDJDQUF3QztBQUl4QyxTQUFnQixZQUFZLENBQUMsRUFDM0IsTUFBTSxFQUNOLFVBQVUsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLEVBQ3ZCLFdBQVcsR0FBRyxTQUFTLEVBQ3ZCLGVBQWUsR0FBRyxTQUFTLEVBQzNCLGlCQUFpQixHQUFHLFNBQVMsRUFDN0Isb0JBQW9CLEdBQUcsU0FBUyxFQUNoQyxzQkFBc0IsR0FBRyxTQUFTLEVBQ2xDLGNBQWMsR0FBRyxTQUFTLEdBVTNCO0lBQ0MsTUFBTSxjQUFjLEdBQWtCLHFCQUFTLENBQUMsTUFBTSxFQUFFO1FBQ3RELENBQUMsdUJBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQXVCLEVBQUUsRUFBRSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLGNBQWMsQ0FBQztRQUNqSCxDQUFDLHVCQUFVLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxJQUF1QixFQUFFLEVBQUUsQ0FDakQsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxlQUFlLEVBQUUsY0FBYyxDQUFDO1FBQ3JFLENBQUMsdUJBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLElBQXVCLEVBQUUsRUFBRSxDQUNyRCxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxjQUFjLENBQUM7UUFDekUsQ0FBQyx1QkFBVSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsSUFBdUIsRUFBRSxFQUFFLENBQ3BELFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztZQUN6QixDQUFDLENBQUMsbUJBQW1CLENBQ2pCLDJCQUFpQixFQUNqQixJQUFJLEVBQ0osaUJBQWlCLElBQUksV0FB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LEVBQUU7UUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUU7WUFDM0QsSUFBSSxXQUFXLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFO2dCQUMvRSxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7YUFDakM7aUJBQU0sSUFBSSxjQUFjLElBQUksTUFBTSxJQUFJLEtBQUssRUFBRTtnQkFDNUMsS0FBSyxNQUFNLE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDN0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFO3dCQUN2RSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7cUJBQzVCO2lCQUNGO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sSUFBSSxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUN2QztBQUNILENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvYXJkYXRfMDAwL0d1aWxkL2dyYXBocWwtdG9vbHMvcGFja2FnZXMvdXRpbHMvc3JjL2ZpbHRlclNjaGVtYS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBHcmFwaFFMRW51bVR5cGUsXG4gIEdyYXBoUUxJbnB1dE9iamVjdFR5cGUsXG4gIEdyYXBoUUxJbnRlcmZhY2VUeXBlLFxuICBHcmFwaFFMT2JqZWN0VHlwZSxcbiAgR3JhcGhRTFNjYWxhclR5cGUsXG4gIEdyYXBoUUxVbmlvblR5cGUsXG4gIEdyYXBoUUxTY2hlbWEsXG59IGZyb20gJ2dyYXBocWwnO1xuXG5pbXBvcnQgeyBNYXBwZXJLaW5kLCBGaWVsZEZpbHRlciwgUm9vdEZpZWxkRmlsdGVyLCBUeXBlRmlsdGVyLCBBcmd1bWVudEZpbHRlciB9IGZyb20gJy4vSW50ZXJmYWNlcyc7XG5cbmltcG9ydCB7IG1hcFNjaGVtYSB9IGZyb20gJy4vbWFwU2NoZW1hJztcblxuaW1wb3J0IHsgQ29uc3RydWN0b3IgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGZpbHRlclNjaGVtYSh7XG4gIHNjaGVtYSxcbiAgdHlwZUZpbHRlciA9ICgpID0+IHRydWUsXG4gIGZpZWxkRmlsdGVyID0gdW5kZWZpbmVkLFxuICByb290RmllbGRGaWx0ZXIgPSB1bmRlZmluZWQsXG4gIG9iamVjdEZpZWxkRmlsdGVyID0gdW5kZWZpbmVkLFxuICBpbnRlcmZhY2VGaWVsZEZpbHRlciA9IHVuZGVmaW5lZCxcbiAgaW5wdXRPYmplY3RGaWVsZEZpbHRlciA9IHVuZGVmaW5lZCxcbiAgYXJndW1lbnRGaWx0ZXIgPSB1bmRlZmluZWQsXG59OiB7XG4gIHNjaGVtYTogR3JhcGhRTFNjaGVtYTtcbiAgcm9vdEZpZWxkRmlsdGVyPzogUm9vdEZpZWxkRmlsdGVyO1xuICB0eXBlRmlsdGVyPzogVHlwZUZpbHRlcjtcbiAgZmllbGRGaWx0ZXI/OiBGaWVsZEZpbHRlcjtcbiAgb2JqZWN0RmllbGRGaWx0ZXI/OiBGaWVsZEZpbHRlcjtcbiAgaW50ZXJmYWNlRmllbGRGaWx0ZXI/OiBGaWVsZEZpbHRlcjtcbiAgaW5wdXRPYmplY3RGaWVsZEZpbHRlcj86IEZpZWxkRmlsdGVyO1xuICBhcmd1bWVudEZpbHRlcj86IEFyZ3VtZW50RmlsdGVyO1xufSk6IEdyYXBoUUxTY2hlbWEge1xuICBjb25zdCBmaWx0ZXJlZFNjaGVtYTogR3JhcGhRTFNjaGVtYSA9IG1hcFNjaGVtYShzY2hlbWEsIHtcbiAgICBbTWFwcGVyS2luZC5RVUVSWV06ICh0eXBlOiBHcmFwaFFMT2JqZWN0VHlwZSkgPT4gZmlsdGVyUm9vdEZpZWxkcyh0eXBlLCAnUXVlcnknLCByb290RmllbGRGaWx0ZXIsIGFyZ3VtZW50RmlsdGVyKSxcbiAgICBbTWFwcGVyS2luZC5NVVRBVElPTl06ICh0eXBlOiBHcmFwaFFMT2JqZWN0VHlwZSkgPT5cbiAgICAgIGZpbHRlclJvb3RGaWVsZHModHlwZSwgJ011dGF0aW9uJywgcm9vdEZpZWxkRmlsdGVyLCBhcmd1bWVudEZpbHRlciksXG4gICAgW01hcHBlcktpbmQuU1VCU0NSSVBUSU9OXTogKHR5cGU6IEdyYXBoUUxPYmplY3RUeXBlKSA9PlxuICAgICAgZmlsdGVyUm9vdEZpZWxkcyh0eXBlLCAnU3Vic2NyaXB0aW9uJywgcm9vdEZpZWxkRmlsdGVyLCBhcmd1bWVudEZpbHRlciksXG4gICAgW01hcHBlcktpbmQuT0JKRUNUX1RZUEVdOiAodHlwZTogR3JhcGhRTE9iamVjdFR5cGUpID0+XG4gICAgICB0eXBlRmlsdGVyKHR5cGUubmFtZSwgdHlwZSlcbiAgICAgICAgPyBmaWx0ZXJFbGVtZW50RmllbGRzPEdyYXBoUUxPYmplY3RUeXBlPihcbiAgICAgICAgICAgIEdyYXBoUUxPYmplY3RUeXBlLFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIG9iamVjdEZpZWxkRmlsdGVyIHx8IGZpZWxkRmlsdGVyLFxuICAgICAgICAgICAgYXJndW1lbnRGaWx0ZXJcbiAgICAgICAgICApXG4gICAgICAgIDogbnVsbCxcbiAgICBbTWFwcGVyS2luZC5JTlRFUkZBQ0VfVFlQRV06ICh0eXBlOiBHcmFwaFFMSW50ZXJmYWNlVHlwZSkgPT5cbiAgICAgIHR5cGVGaWx0ZXIodHlwZS5uYW1lLCB0eXBlKVxuICAgICAgICA/IGZpbHRlckVsZW1lbnRGaWVsZHM8R3JhcGhRTEludGVyZmFjZVR5cGU+KFxuICAgICAgICAgICAgR3JhcGhRTEludGVyZmFjZVR5cGUsXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgaW50ZXJmYWNlRmllbGRGaWx0ZXIgfHwgZmllbGRGaWx0ZXIsXG4gICAgICAgICAgICBhcmd1bWVudEZpbHRlclxuICAgICAgICAgIClcbiAgICAgICAgOiBudWxsLFxuICAgIFtNYXBwZXJLaW5kLklOUFVUX09CSkVDVF9UWVBFXTogKHR5cGU6IEdyYXBoUUxJbnB1dE9iamVjdFR5cGUpID0+XG4gICAgICB0eXBlRmlsdGVyKHR5cGUubmFtZSwgdHlwZSlcbiAgICAgICAgPyBmaWx0ZXJFbGVtZW50RmllbGRzPEdyYXBoUUxJbnB1dE9iamVjdFR5cGU+KFxuICAgICAgICAgICAgR3JhcGhRTElucHV0T2JqZWN0VHlwZSxcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBpbnB1dE9iamVjdEZpZWxkRmlsdGVyIHx8IGZpZWxkRmlsdGVyXG4gICAgICAgICAgKVxuICAgICAgICA6IG51bGwsXG4gICAgW01hcHBlcktpbmQuVU5JT05fVFlQRV06ICh0eXBlOiBHcmFwaFFMVW5pb25UeXBlKSA9PiAodHlwZUZpbHRlcih0eXBlLm5hbWUsIHR5cGUpID8gdW5kZWZpbmVkIDogbnVsbCksXG4gICAgW01hcHBlcktpbmQuRU5VTV9UWVBFXTogKHR5cGU6IEdyYXBoUUxFbnVtVHlwZSkgPT4gKHR5cGVGaWx0ZXIodHlwZS5uYW1lLCB0eXBlKSA/IHVuZGVmaW5lZCA6IG51bGwpLFxuICAgIFtNYXBwZXJLaW5kLlNDQUxBUl9UWVBFXTogKHR5cGU6IEdyYXBoUUxTY2FsYXJUeXBlKSA9PiAodHlwZUZpbHRlcih0eXBlLm5hbWUsIHR5cGUpID8gdW5kZWZpbmVkIDogbnVsbCksXG4gIH0pO1xuXG4gIHJldHVybiBmaWx0ZXJlZFNjaGVtYTtcbn1cblxuZnVuY3Rpb24gZmlsdGVyUm9vdEZpZWxkcyhcbiAgdHlwZTogR3JhcGhRTE9iamVjdFR5cGUsXG4gIG9wZXJhdGlvbjogJ1F1ZXJ5JyB8ICdNdXRhdGlvbicgfCAnU3Vic2NyaXB0aW9uJyxcbiAgcm9vdEZpZWxkRmlsdGVyPzogUm9vdEZpZWxkRmlsdGVyLFxuICBhcmd1bWVudEZpbHRlcj86IEFyZ3VtZW50RmlsdGVyXG4pOiBHcmFwaFFMT2JqZWN0VHlwZSB7XG4gIGlmIChyb290RmllbGRGaWx0ZXIgfHwgYXJndW1lbnRGaWx0ZXIpIHtcbiAgICBjb25zdCBjb25maWcgPSB0eXBlLnRvQ29uZmlnKCk7XG4gICAgT2JqZWN0LmVudHJpZXMoY29uZmlnLmZpZWxkcykuZm9yRWFjaCgoW2ZpZWxkTmFtZSwgZmllbGRdKSA9PiB7XG4gICAgICBpZiAocm9vdEZpZWxkRmlsdGVyICYmICFyb290RmllbGRGaWx0ZXIob3BlcmF0aW9uLCBmaWVsZE5hbWUsIGNvbmZpZy5maWVsZHNbZmllbGROYW1lXSkpIHtcbiAgICAgICAgZGVsZXRlIGNvbmZpZy5maWVsZHNbZmllbGROYW1lXTtcbiAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRGaWx0ZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBhcmdOYW1lIG9mIE9iamVjdC5rZXlzKGZpZWxkLmFyZ3MpKSB7XG4gICAgICAgICAgaWYgKCFhcmd1bWVudEZpbHRlcihvcGVyYXRpb24sIGZpZWxkTmFtZSwgYXJnTmFtZSwgZmllbGQuYXJnc1thcmdOYW1lXSkpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBmaWVsZC5hcmdzW2FyZ05hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBuZXcgR3JhcGhRTE9iamVjdFR5cGUoY29uZmlnKTtcbiAgfVxuICByZXR1cm4gdHlwZTtcbn1cblxuZnVuY3Rpb24gZmlsdGVyRWxlbWVudEZpZWxkczxFbGVtZW50VHlwZT4oXG4gIEVsZW1lbnRDb25zdHJ1Y3RvcjogQ29uc3RydWN0b3I8RWxlbWVudFR5cGU+LFxuICB0eXBlOiBHcmFwaFFMT2JqZWN0VHlwZSB8IEdyYXBoUUxJbnRlcmZhY2VUeXBlIHwgR3JhcGhRTElucHV0T2JqZWN0VHlwZSxcbiAgZmllbGRGaWx0ZXI/OiBGaWVsZEZpbHRlcixcbiAgYXJndW1lbnRGaWx0ZXI/OiBBcmd1bWVudEZpbHRlclxuKTogRWxlbWVudFR5cGUgfCB1bmRlZmluZWQge1xuICBpZiAoZmllbGRGaWx0ZXIgfHwgYXJndW1lbnRGaWx0ZXIpIHtcbiAgICBjb25zdCBjb25maWcgPSB0eXBlLnRvQ29uZmlnKCk7XG4gICAgT2JqZWN0LmVudHJpZXMoY29uZmlnLmZpZWxkcykuZm9yRWFjaCgoW2ZpZWxkTmFtZSwgZmllbGRdKSA9PiB7XG4gICAgICBpZiAoZmllbGRGaWx0ZXIgJiYgIWZpZWxkRmlsdGVyKHR5cGUubmFtZSwgZmllbGROYW1lLCBjb25maWcuZmllbGRzW2ZpZWxkTmFtZV0pKSB7XG4gICAgICAgIGRlbGV0ZSBjb25maWcuZmllbGRzW2ZpZWxkTmFtZV07XG4gICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50RmlsdGVyICYmICdhcmdzJyBpbiBmaWVsZCkge1xuICAgICAgICBmb3IgKGNvbnN0IGFyZ05hbWUgb2YgT2JqZWN0LmtleXMoZmllbGQuYXJncykpIHtcbiAgICAgICAgICBpZiAoIWFyZ3VtZW50RmlsdGVyKHR5cGUubmFtZSwgZmllbGROYW1lLCBhcmdOYW1lLCBmaWVsZC5hcmdzW2FyZ05hbWVdKSkge1xuICAgICAgICAgICAgZGVsZXRlIGZpZWxkLmFyZ3NbYXJnTmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG5ldyBFbGVtZW50Q29uc3RydWN0b3IoY29uZmlnKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9